# Журнал изменений

## v0.1.6 - 2026-02-10

### Добавлено

- Добавлена поддержка webhook URL с IDN-доменами: адрес перед подпиской приводится к Punycode (`748b129`). Это нужно для корректной TLS-валидации webhook URL в Max API.

### Улучшено

- Исправлен сценарий отправки файлов и изображений: вложения в проблемных кейсах снова отправляются (`1bc596c`).
- Добавлен fallback в plain text при ответе Max API `Some Markdown syntax is not supported...`, чтобы сообщение отправлялось даже при неподдерживаемой части Markdown-разметки (`1bc596c`).

### Для разработки

- Добавлен pre-commit запуск Prettier для staged-файлов (`1bc596c`).

### Кому важно

- Пользователям `Max Trigger` с webhook URL на IDN-доменах.
- Пользователям, у которых были сбои отправки файлов/изображений.
- Пользователям, у которых сообщения с Markdown периодически не отправлялись из-за ограничений Max API.

### Что проверить после обновления

- Если раньше trigger не активировался на IDN-домене, переактивировать workflow и проверить создание подписки.
- Проверить отправку файла и изображения в вашем типовом сценарии.
- Проверить сценарий с Markdown-сообщениями, которые раньше падали с ошибкой `Some Markdown syntax is not supported...`.

## v0.1.5 - 2026-02-09

### Улучшено

- Токен в API-запросах теперь передаётся в заголовке `Authorization`, а не в query-параметре URL (`f07ea20`). Это соответствует текущему формату авторизации Max API.

### Сопровождение

- Обновлены сообщения stale-бота для issues/PR (`da335f2`).
- Уточнена пользовательская документация в README (`d9fc4cc`).

### Кому важно

- Всем пользователям ноды, которые отправляют запросы к Max API через `Max`/`Max Trigger`.
- Пользователям с прокси/WAF или кастомным API-контуром, где фильтруются заголовки.

### Что проверить после обновления

- Убедиться, что в вашей инфраструктуре не блокируется заголовок `Authorization`.
- Если используется кастомный `baseUrl`, выполнить тестовую отправку сообщения и активацию trigger.

## v0.1.4 - 2025-07-23

### Добавлено

- В `Send Message` добавлена возможность отправлять reply на конкретное сообщение (`5eb09b6`).

### Кому важно

- Пользователям, которым нужны ответные сообщения в контексте конкретного `message_id`.

### Что проверить после обновления

- Проверить сценарий `Send Message` с заполненным `Reply to Message ID`.

## v0.1.3 - 2025-07-23

### Улучшено

- Расширена валидация ID: поддержаны отрицательные и нулевые значения там, где они допустимы (`4d7f4fd`).
- Улучшены тексты ошибок валидации ID (`4d7f4fd`).

### Кому важно

- Пользователям, работающим с ID, которые раньше отклонялись валидацией.

### Что проверить после обновления

- Повторно запустить workflow, где раньше была ошибка валидации ID.

## v0.1.2 - 2025-07-22

### Улучшено

- Скорректирована валидация Chat ID (с поддержкой неотрицательных значений) (`417e80e`).
- Улучшены тексты ошибок для Chat ID (`417e80e`).

### Кому важно

- Пользователям, у которых `Chat ID` отклонялся при отправке сообщения или чат-операциях.

### Что проверить после обновления

- Проверить операции, где используется `Chat ID` (`Send Message to Chat`, `Get Chat`, `Leave Chat`).

## v0.1.1 - 2025-07-22

### Добавлено

- Первый публичный релиз `n8n-nodes-max`.
- Добавлены `Max` и `Max Trigger` для исходящих действий и webhook-триггеров в Max.
- Добавлена поддержка вложений и inline-клавиатур.
- Добавлен скрипт для локальной проверки webhook через туннель (`9afc415`).

### Улучшено

- Добавлена валидация и метаданные в обработку webhook-событий (`b5dd5ee`).
- Удалены legacy/deprecated поля и структура событий выровнена с актуальной схемой API (`186e639`).
- Упрощена обработка событий и убраны устаревшие поля (`7fc9476`).

### Для разработки

- Добавлены интеграционные тесты и фикстуры для webhook-событий (`6d76a14`).

### Кому важно

- Всем новым пользователям ноды `n8n-nodes-max`.

### Что проверить после обновления

- Настроить `MaxApi` credentials.
- Выполнить тестовую отправку сообщения и тестовую активацию `Max Trigger`.
